<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.leave.system.mapper.LeaveAccountMapper">

    <select id="selectAccountByUserIdAndYearIncludeDeleted" resultType="com.leave.system.entity.LeaveAccount">
        SELECT * FROM leave_account WHERE user_id = #{userId} AND year = #{year}
    </select>
    
    <select id="selectAccountByUserIdAndYear" resultType="com.leave.system.entity.LeaveAccount">
        SELECT * FROM leave_account WHERE user_id = #{userId} AND year = #{year} AND deleted = 0
    </select>

    <select id="selectLastYearAccount" resultType="com.leave.system.entity.LeaveAccount">
        SELECT * FROM leave_account WHERE user_id = #{userId} AND year = #{year} - 1 AND deleted = 0
    </select>

    <delete id="deleteByUserId">
        UPDATE leave_account SET deleted = 1 WHERE user_id = #{userId}
    </delete>

    <select id="selectDistinctYears" resultType="java.lang.Integer">
        SELECT DISTINCT year FROM leave_account ORDER BY year DESC
    </select>

    <select id="selectAccountsByYear" resultType="com.leave.system.entity.LeaveAccount">
        SELECT * FROM leave_account WHERE year = #{year} AND deleted = 0
    </select>

    <insert id="insertAccount" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO leave_account (user_id, year, social_seniority, standard_quota, days_employed, actual_quota, last_year_balance, current_year_used, deleted)
        VALUES (#{userId}, #{year}, #{socialSeniority}, #{standardQuota}, #{daysEmployed}, #{actualQuota}, #{lastYearBalance}, #{currentYearUsed}, #{deleted})
    </insert>

    <update id="updateAccount">
        UPDATE leave_account
        <set>
            <if test="userId != null">user_id = #{userId},</if>
            <if test="year != null">year = #{year},</if>
            <if test="socialSeniority != null">social_seniority = #{socialSeniority},</if>
            <if test="standardQuota != null">standard_quota = #{standardQuota},</if>
            <if test="daysEmployed != null">days_employed = #{daysEmployed},</if>
            <if test="actualQuota != null">actual_quota = #{actualQuota},</if>
            <if test="lastYearBalance != null">last_year_balance = #{lastYearBalance},</if>
            <if test="currentYearUsed != null">current_year_used = #{currentYearUsed},</if>
            <if test="deleted != null">deleted = #{deleted},</if>
        </set>
        WHERE id = #{id}
    </update>

</mapper>
