import{_ as ue,r,c as re,o as de,e as b,f as m,g as i,k as l,w as a,l as u,m as w,B as d,i as j,y as x,h as U,F as L,x as W,j as ie,C as pe,E as S,D as p}from"./index-CYhBYbOp.js";const me={class:"toolbar"},fe={class:"dialog-footer"},ve={key:0,style:{"margin-top":"20px"}},ce={key:0,style:{"max-height":"200px","overflow-y":"auto","margin-top":"10px"}},ye={__name:"User",setup(we){const T=r([]),N=r([]),_=r(!1),k=r("add"),I=r(1),$=r(10),R=r(0),D=r(!1),z=r(null),V=r(null),B=r(!1),f=r(null),n=r({id:null,employeeNumber:"",username:"",password:"",realName:"",dingtalkUserId:"",firstWorkDate:"",entryDate:"",socialSeniority:0,roleId:null}),O=re(()=>k.value==="add"?"添加用户":"编辑用户"),P=o=>{const e=N.value.find(s=>s.id===o);return e?e.roleName:"未知"},A=async()=>{try{const o=await w.get("/system/role/list");N.value=o}catch(o){console.error(o)}},y=async()=>{try{const o=await w.get("/system/user/list",{params:{current:I.value,size:$.value}});T.value=o.records,R.value=o.total}catch(o){console.error(o)}},E=(o,e=null)=>{k.value=o,o==="add"?n.value={id:null,employeeNumber:"",username:"",password:"",realName:"",dingtalkUserId:"",firstWorkDate:"",entryDate:"",socialSeniority:0,roleId:null}:n.value={...e,password:""},_.value=!0},q=async()=>{try{k.value==="add"?(await w.post("/system/user/add",n.value),p.success("用户已添加")):(await w.put("/system/user/update",n.value),p.success("用户已更新")),_.value=!1,y()}catch(o){console.error(o)}},G=async o=>{try{await S.confirm(`确定要删除用户 ${o.realName} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await w.delete(`/system/user/delete/${o.id}`),p.success("用户已删除"),y()}catch(e){e!=="cancel"&&console.error(e)}},H=async o=>{try{await S.confirm(`确定要将 ${o.realName} 设置为离职状态吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await w.post(`/system/user/resign/${o.id}`),p.success("操作成功"),y()}catch(e){e!=="cancel"&&(console.error(e),p.error("操作失败"))}},J=async o=>{try{await S.confirm(`确定要恢复 ${o.realName} 为在职状态吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"}),await w.post(`/system/user/activate/${o.id}`),p.success("操作成功"),y()}catch(e){e!=="cancel"&&(console.error(e),p.error("操作失败"))}},K=()=>{D.value=!0,V.value=null,f.value=null},Q=o=>{V.value=o.raw},X=()=>{const o=`工号,姓名,入职日期,首次参加工作日期,钉钉ID
E001,张三,2024-01-15,2020-06-01,zhangsan123
E002,李四,2024-02-01,2018-03-15,lisi456`,e=new Blob(["\uFEFF"+o],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");s.href=URL.createObjectURL(e),s.download="用户导入模板.csv",s.click(),URL.revokeObjectURL(s.href),p.success("模板下载成功")},Z=async()=>{if(!V.value){p.warning("请先选择文件");return}const o=new FormData;o.append("file",V.value),B.value=!0,f.value=null;try{const e=await w.post("/system/user/import",o,{headers:{"Content-Type":"multipart/form-data"},timeout:6e4});f.value=e,e.successCount>0&&(p.success(`成功导入 ${e.successCount} 个用户`),y()),e.failureCount>0&&p.warning(`${e.failureCount} 个用户导入失败，请查看详情`),z.value&&z.value.clearFiles(),V.value=null}catch(e){console.error("导入失败",e),p.error("导入失败")}finally{B.value=!1}};return de(()=>{y(),A()}),(o,e)=>{const s=u("el-button"),v=u("el-table-column"),h=u("el-tag"),ee=u("el-table"),le=u("el-pagination"),g=u("el-input"),c=u("el-form-item"),te=u("el-option"),ae=u("el-select"),M=u("el-date-picker"),oe=u("el-form"),Y=u("el-dialog"),F=u("el-alert"),ne=u("el-icon"),se=u("el-upload");return m(),b("div",null,[i("div",me,[e[18]||(e[18]=i("span",null,null,-1)),i("div",null,[l(s,{type:"success",onClick:K},{default:a(()=>[...e[16]||(e[16]=[d("导入用户",-1)])]),_:1}),l(s,{type:"primary",onClick:e[0]||(e[0]=t=>E("add"))},{default:a(()=>[...e[17]||(e[17]=[d("添加用户",-1)])]),_:1})])]),l(ee,{data:T.value,style:{width:"100%"}},{default:a(()=>[l(v,{prop:"employeeNumber",label:"编号",width:"100"}),l(v,{prop:"username",label:"用户名",width:"120"}),l(v,{prop:"realName",label:"姓名","min-width":"100"}),l(v,{prop:"entryDate",label:"入职日期",width:"120"}),l(v,{prop:"firstWorkDate",label:"首次参加工作时间",width:"140"}),l(v,{prop:"socialSeniority",label:"社会工龄(年)",width:"80"}),l(v,{prop:"dingtalkUserId",label:"钉钉ID","min-width":"150"}),l(v,{label:"角色","min-width":"140","show-overflow-tooltip":""},{default:a(t=>[l(h,null,{default:a(()=>[d(j(P(t.row.roleId)),1)]),_:2},1024)]),_:1}),l(v,{label:"操作",width:"280",fixed:"right"},{default:a(t=>[l(s,{type:"primary",size:"small",onClick:C=>E("edit",t.row)},{default:a(()=>[...e[19]||(e[19]=[d("编辑",-1)])]),_:1},8,["onClick"]),t.row.status==="ACTIVE"||!t.row.status?(m(),x(s,{key:0,type:"warning",size:"small",onClick:C=>H(t.row)},{default:a(()=>[...e[20]||(e[20]=[d("离职",-1)])]),_:1},8,["onClick"])):(m(),x(s,{key:1,type:"success",size:"small",onClick:C=>J(t.row)},{default:a(()=>[...e[21]||(e[21]=[d("恢复在职",-1)])]),_:1},8,["onClick"])),l(s,{type:"danger",size:"small",onClick:C=>G(t.row)},{default:a(()=>[...e[22]||(e[22]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),l(le,{"current-page":I.value,"onUpdate:currentPage":e[1]||(e[1]=t=>I.value=t),"page-size":$.value,"onUpdate:pageSize":e[2]||(e[2]=t=>$.value=t),"page-sizes":[10,20,50,100],total:R.value,layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"20px","justify-content":"flex-end"},onSizeChange:y,onCurrentChange:y},null,8,["current-page","page-size","total"]),l(Y,{modelValue:_.value,"onUpdate:modelValue":e[13]||(e[13]=t=>_.value=t),title:O.value,width:"600px"},{footer:a(()=>[i("span",fe,[l(s,{onClick:e[12]||(e[12]=t=>_.value=!1)},{default:a(()=>[...e[23]||(e[23]=[d("取消",-1)])]),_:1}),l(s,{type:"primary",onClick:q},{default:a(()=>[...e[24]||(e[24]=[d("确认",-1)])]),_:1})])]),default:a(()=>[l(oe,{model:n.value,"label-width":"140px"},{default:a(()=>[l(c,{label:"编号"},{default:a(()=>[l(g,{modelValue:n.value.employeeNumber,"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.employeeNumber=t),style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(c,{label:"用户名"},{default:a(()=>[l(g,{modelValue:n.value.username,"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.username=t),style:{width:"100%"}},null,8,["modelValue"])]),_:1}),k.value==="add"?(m(),x(c,{key:0,label:"密码"},{default:a(()=>[l(g,{modelValue:n.value.password,"onUpdate:modelValue":e[5]||(e[5]=t=>n.value.password=t),type:"password",style:{width:"100%"}},null,8,["modelValue"])]),_:1})):U("",!0),k.value==="edit"?(m(),x(c,{key:1,label:"修改密码"},{default:a(()=>[l(g,{modelValue:n.value.password,"onUpdate:modelValue":e[6]||(e[6]=t=>n.value.password=t),type:"password",placeholder:"留空则不修改密码",style:{width:"100%"}},null,8,["modelValue"])]),_:1})):U("",!0),l(c,{label:"真实姓名"},{default:a(()=>[l(g,{modelValue:n.value.realName,"onUpdate:modelValue":e[7]||(e[7]=t=>n.value.realName=t),style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(c,{label:"钉钉ID"},{default:a(()=>[l(g,{modelValue:n.value.dingtalkUserId,"onUpdate:modelValue":e[8]||(e[8]=t=>n.value.dingtalkUserId=t),style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(c,{label:"角色"},{default:a(()=>[l(ae,{modelValue:n.value.roleId,"onUpdate:modelValue":e[9]||(e[9]=t=>n.value.roleId=t),placeholder:"请选择角色",style:{width:"100%"}},{default:a(()=>[(m(!0),b(L,null,W(N.value,t=>(m(),x(te,{key:t.id,label:t.roleName,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(c,{label:"首次参加工作时间"},{default:a(()=>[l(M,{modelValue:n.value.firstWorkDate,"onUpdate:modelValue":e[10]||(e[10]=t=>n.value.firstWorkDate=t),type:"date",placeholder:"选择日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(c,{label:"入职日期"},{default:a(()=>[l(M,{modelValue:n.value.entryDate,"onUpdate:modelValue":e[11]||(e[11]=t=>n.value.entryDate=t),type:"date",placeholder:"选择日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(Y,{modelValue:D.value,"onUpdate:modelValue":e[15]||(e[15]=t=>D.value=t),title:"导入用户",width:"500px"},{footer:a(()=>[i("span",null,[l(s,{onClick:e[14]||(e[14]=t=>D.value=!1)},{default:a(()=>[...e[29]||(e[29]=[d("取消",-1)])]),_:1}),l(s,{type:"primary",onClick:Z,loading:B.value},{default:a(()=>[...e[30]||(e[30]=[d("开始导入",-1)])]),_:1},8,["loading"])])]),default:a(()=>[l(F,{title:"导入说明",type:"info",closable:!1,style:{"margin-bottom":"15px"}},{default:a(()=>[...e[25]||(e[25]=[i("p",null,"1. 请下载CSV模板并填写用户信息",-1),i("p",null,"2. 必填字段：工号、姓名",-1),i("p",null,"3. 默认密码：123456，角色：员工",-1),i("p",null,"4. 用户名将自动生成为姓名拼音",-1)])]),_:1}),l(s,{type:"primary",onClick:X,style:{"margin-bottom":"15px"}},{default:a(()=>[...e[26]||(e[26]=[d(" 下载CSV模板 ",-1)])]),_:1}),l(se,{ref_key:"uploadRef",ref:z,"auto-upload":!1,"on-change":Q,limit:1,accept:".csv",drag:""},{tip:a(()=>[...e[27]||(e[27]=[i("div",{class:"el-upload__tip"},"只支持CSV格式文件",-1)])]),default:a(()=>[l(ne,{class:"el-icon--upload"},{default:a(()=>[l(ie(pe))]),_:1}),e[28]||(e[28]=i("div",{class:"el-upload__text"},[d(" 拖拽文件到此处或"),i("em",null,"点击选择文件")],-1))]),_:1},512),f.value?(m(),b("div",ve,[l(F,{title:`导入完成：成功 ${f.value.successCount} 条，失败 ${f.value.failureCount} 条`,type:f.value.failureCount>0?"warning":"success",closable:!1},{default:a(()=>[f.value.errors&&f.value.errors.length>0?(m(),b("div",ce,[(m(!0),b(L,null,W(f.value.errors,(t,C)=>(m(),b("p",{key:C,style:{margin:"5px 0",color:"#f56c6c"}},j(t),1))),128))])):U("",!0)]),_:1},8,["title","type"])])):U("",!0)]),_:1},8,["modelValue"])])}}},be=ue(ye,[["__scopeId","data-v-31032af7"]]);export{be as default};
