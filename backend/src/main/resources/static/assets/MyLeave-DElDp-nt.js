import{_ as H,u as O,r as v,c as D,o as P,b as X,e as p,f as d,k as a,g as t,w as l,l as i,D as C,m as f,B as r,i as n,y as g,j as $,F as j,x as q,h as M}from"./index-ClRhICUb.js";const G={class:"card-header"},K={style:{"line-height":"1.5"}},Z={key:0},ee={key:1,class:"mobile-balance-container"},te={class:"main-balance-card"},ae={class:"value"},se={class:"balance-grid"},le={class:"grid-item"},oe={class:"grid-value"},ne={class:"grid-item"},re={class:"grid-value"},ie={class:"grid-item"},de={class:"grid-value"},ce={class:"grid-item"},ue={class:"grid-value"},_e={key:1,class:"empty-state"},ve={class:"action-btn"},pe={class:"history-container"},me={class:"history-header"},ye={__name:"MyLeave",setup(be){const h=O(),m=new Date().getFullYear(),o=v(null),E=v([]),A=v([]),y=v(m),T=v(window.innerWidth),b=D(()=>T.value<768);D(()=>b.value?1:2);const k=D(()=>o.value&&o.value.totalBalance||0),S=s=>({ANNUAL:"年假",ADJUSTMENT_ADD:"额度增加",ADJUSTMENT_DEDUCT:"额度扣除",CARRY_OVER:"上年结转",EXPIRED:"过期清理"})[s]||s,V=s=>({ANNUAL:"",ADJUSTMENT_ADD:"warning",ADJUSTMENT_DEDUCT:"danger",CARRY_OVER:"success",EXPIRED:"info"})[s]||"",U=async()=>{const s=h.userId;if(!s){C.warning("未找到用户信息，请重新登录");return}try{const e=await f.get("/leave/account",{params:{userId:s,year:m}});o.value=e}catch(e){console.error(e)}},N=async()=>{const s=h.userId;if(s)try{const e={userId:s};y.value&&(e.year=y.value);const w=await f.get("/leave/history",{params:e});E.value=w}catch(e){console.error(e)}},x=async()=>{try{const s=await f.get("/leave/available-years");A.value=s}catch(s){console.error(s)}},B=async()=>{const s=h.userId;if(s)try{await f.post(`/leave/init?userId=${s}&year=${m}`),C.success("账户初始化成功"),U()}catch(e){console.error(e)}},R=()=>{T.value=window.innerWidth};return P(()=>{U(),N(),x(),window.addEventListener("resize",R)}),X(()=>{window.removeEventListener("resize",R)}),(s,e)=>{const w=i("el-alert"),c=i("el-descriptions-item"),Y=i("el-tag"),L=i("el-descriptions"),z=i("el-empty"),J=i("el-button"),Q=i("el-card"),I=i("el-option"),F=i("el-select"),_=i("el-table-column"),W=i("el-table");return d(),p("div",null,[a(Q,{class:"box-card"},{header:l(()=>[t("div",G,[t("span",null,"我的假期余额 ("+n($(m))+")",1)])]),default:l(()=>[a(w,{title:"",type:"info","show-icon":"",closable:!1,class:"sync-alert"},{default:l(()=>[t("div",K,[e[1]||(e[1]=r(" 请假记录每周一从钉钉同步。",-1)),e[2]||(e[2]=t("br",null,null,-1)),r(" 上次同步："+n(o.value?.lastSyncTime||"获取中..."),1)])]),_:1}),o.value?(d(),p("div",Z,[b.value?(d(),p("div",ee,[t("div",te,[e[3]||(e[3]=t("div",{class:"label"},"可休合计 (天)",-1)),t("div",ae,n(k.value),1),e[4]||(e[4]=t("div",{class:"sub-label"},"账户状态: 正常活跃",-1))]),t("div",se,[t("div",le,[e[5]||(e[5]=t("span",{class:"grid-label"},"每年额度",-1)),t("span",oe,n(o.value.standardQuota),1)]),t("div",ne,[e[6]||(e[6]=t("span",{class:"grid-label"},"当年实际",-1)),t("span",re,n(o.value.actualQuota),1)]),t("div",ie,[e[7]||(e[7]=t("span",{class:"grid-label"},"上年结转",-1)),t("span",de,n(o.value.lastYearBalance),1)]),t("div",ce,[e[8]||(e[8]=t("span",{class:"grid-label"},"本年已用",-1)),t("span",ue,n(o.value.currentYearUsed),1)])])])):(d(),g(L,{key:0,column:2,border:""},{default:l(()=>[a(c,{label:"工龄"},{default:l(()=>[r(n(o.value.socialSeniority)+" 年",1)]),_:1}),a(c,{label:"入职日期"},{default:l(()=>[r(n(o.value.entryDate),1)]),_:1}),a(c,{label:"每年年假额度"},{default:l(()=>[r(n(o.value.standardQuota)+" 天",1)]),_:1}),a(c,{label:"上年结余"},{default:l(()=>[r(n(o.value.lastYearBalance)+" 天",1)]),_:1}),a(c,{label:"当年在职天数"},{default:l(()=>[r(n(o.value.daysEmployed)+" 天",1)]),_:1}),a(c,{label:"当年年假天数"},{default:l(()=>[r(n(o.value.actualQuota)+" 天",1)]),_:1}),a(c,{label:"本年已用"},{default:l(()=>[r(n(o.value.currentYearUsed)+" 天",1)]),_:1}),a(c,{label:"总可用余额"},{default:l(()=>[a(Y,{type:"success",size:"large"},{default:l(()=>[r(n(k.value)+" 天",1)]),_:1})]),_:1})]),_:1}))])):(d(),p("div",_e,[a(z,{description:"本年度暂无账户信息"}),t("div",ve,[a(J,{type:"primary",onClick:B,round:""},{default:l(()=>[...e[9]||(e[9]=[r("初始化 2026 账户",-1)])]),_:1})])]))]),_:1}),t("div",pe,[t("div",me,[e[10]||(e[10]=t("span",{class:"title"},"休假历史",-1)),a(F,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=u=>y.value=u),placeholder:"选择年份",onChange:N,style:{width:"120px"},clearable:""},{default:l(()=>[a(I,{label:"全部年份",value:null}),(d(!0),p(j,null,q(A.value,u=>(d(),g(I,{key:u,label:u+" 年",value:u},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),a(W,{data:E.value,style:{width:"100%"},class:"custom-table"},{default:l(()=>[a(_,{prop:"startDate",label:"休假日期","min-width":"110"}),b.value?M("",!0):(d(),g(_,{key:0,prop:"endDate",label:"结束日期","min-width":"110"})),a(_,{prop:"days",label:"天数",width:"70"}),a(_,{prop:"type",label:"类型",width:"90"},{default:l(u=>[a(Y,{type:V(u.row.type),size:"small",effect:"light"},{default:l(()=>[r(n(S(u.row.type)),1)]),_:2},1032,["type"])]),_:1}),b.value?M("",!0):(d(),g(_,{key:1,prop:"remarks",label:"备注","min-width":"150","show-overflow-tooltip":""}))]),_:1},8,["data"])])])}}},ge=H(ye,[["__scopeId","data-v-ee5e6e09"]]);export{ge as default};
