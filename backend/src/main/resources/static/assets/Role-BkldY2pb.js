import{_ as j,r as u,c as N,o as A,e as L,f as P,g as V,k as t,w as s,l as r,m as c,B as m,E as G,D as C,G as H}from"./index-CYhBYbOp.js";const O={class:"toolbar"},q={class:"dialog-footer"},F={__name:"Role",setup(J){const g=u([]),p=u(!1),_=u("add"),b=u(1),f=u(10),v=u([]),k=u([]),i=u(null),d=u({id:null,roleName:"",roleKey:"",description:"",menuIds:[]}),z=N(()=>_.value==="add"?"添加角色":"编辑角色"),B=N(()=>{const l=(b.value-1)*f.value,e=l+f.value;return g.value.slice(l,e)}),w=async()=>{try{const l=await c.get("/system/role/list");g.value=l}catch(l){console.error(l)}},K=async()=>{try{const l=await c.get("/system/menu/list");v.value=l}catch(l){console.error(l)}},h=(l,e)=>{let o=[];return l.forEach(n=>{n.children&&n.children.length>0?o=o.concat(h(n.children,e)):e.includes(n.id)&&o.push(n.id)}),o},I=async(l,e=null)=>{if(_.value=l,p.value=!0,k.value=[],i.value&&i.value.setCheckedKeys([]),l==="add")d.value={id:null,roleName:"",roleKey:"",description:"",menuIds:[]};else{d.value={...e,menuIds:[]};try{v.value.length===0&&await K();const o=await c.get(`/system/role/${e.id}/menus`);console.log("Backend returned menuIds:",o);const n=h(v.value,o);console.log("Calculated leafKeys:",n),k.value=n,H(()=>{i.value&&i.value.setCheckedKeys(n)})}catch(o){console.error(o)}}},D=async()=>{try{const l=i.value.getCheckedKeys(),e=i.value.getHalfCheckedKeys();d.value.menuIds=[...l,...e],_.value==="add"?(await c.post("/system/role/add",d.value),C.success("角色已添加")):(await c.put("/system/role/update",d.value),C.success("角色已更新")),p.value=!1,w()}catch(l){console.error(l)}},M=async l=>{try{await G.confirm("确定要删除该角色吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await c.delete(`/system/role/delete/${l.id}`),C.success("角色已删除"),w()}catch(e){e!=="cancel"&&console.error(e)}};return A(()=>{w(),K()}),(l,e)=>{const o=r("el-button"),n=r("el-table-column"),T=r("el-table"),E=r("el-pagination"),x=r("el-input"),y=r("el-form-item"),U=r("el-tree"),$=r("el-form"),R=r("el-dialog");return P(),L("div",null,[V("div",O,[e[9]||(e[9]=V("span",null,null,-1)),t(o,{type:"primary",onClick:e[0]||(e[0]=a=>I("add"))},{default:s(()=>[...e[8]||(e[8]=[m("添加角色",-1)])]),_:1})]),t(T,{data:B.value,style:{width:"100%"}},{default:s(()=>[t(n,{prop:"id",label:"ID",width:"80"}),t(n,{prop:"roleName",label:"角色名称",width:"180"}),t(n,{prop:"roleKey",label:"角色标识",width:"180"}),t(n,{prop:"description",label:"描述"}),t(n,{label:"操作",width:"250"},{default:s(a=>[t(o,{size:"small",onClick:S=>I("edit",a.row)},{default:s(()=>[...e[10]||(e[10]=[m("编辑",-1)])]),_:1},8,["onClick"]),t(o,{size:"small",type:"danger",onClick:S=>M(a.row)},{default:s(()=>[...e[11]||(e[11]=[m("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),t(E,{"current-page":b.value,"onUpdate:currentPage":e[1]||(e[1]=a=>b.value=a),"page-size":f.value,"onUpdate:pageSize":e[2]||(e[2]=a=>f.value=a),"page-sizes":[10,20,50,100],total:g.value.length,layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"]),t(R,{modelValue:p.value,"onUpdate:modelValue":e[7]||(e[7]=a=>p.value=a),title:z.value,width:"600px","destroy-on-close":""},{footer:s(()=>[V("span",q,[t(o,{onClick:e[6]||(e[6]=a=>p.value=!1)},{default:s(()=>[...e[12]||(e[12]=[m("取消",-1)])]),_:1}),t(o,{type:"primary",onClick:D},{default:s(()=>[...e[13]||(e[13]=[m("确认",-1)])]),_:1})])]),default:s(()=>[t($,{model:d.value,"label-width":"100px"},{default:s(()=>[t(y,{label:"角色名称"},{default:s(()=>[t(x,{modelValue:d.value.roleName,"onUpdate:modelValue":e[3]||(e[3]=a=>d.value.roleName=a)},null,8,["modelValue"])]),_:1}),t(y,{label:"角色标识"},{default:s(()=>[t(x,{modelValue:d.value.roleKey,"onUpdate:modelValue":e[4]||(e[4]=a=>d.value.roleKey=a),placeholder:"例如：ROLE_ADMIN"},null,8,["modelValue"])]),_:1}),t(y,{label:"描述"},{default:s(()=>[t(x,{modelValue:d.value.description,"onUpdate:modelValue":e[5]||(e[5]=a=>d.value.description=a)},null,8,["modelValue"])]),_:1}),t(y,{label:"菜单权限"},{default:s(()=>[t(U,{ref_key:"menuTreeRef",ref:i,data:v.value,"show-checkbox":"","node-key":"id","check-strictly":!1,props:{children:"children",label:"menuName"},"default-checked-keys":k.value,style:{width:"100%",border:"1px solid #dcdfe6","border-radius":"4px",padding:"10px"}},null,8,["data","default-checked-keys"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},W=j(F,[["__scopeId","data-v-8eb9e1a4"]]);export{W as default};
