import{_ as W,u as H,r as v,c as w,o as O,b as P,e as p,f as d,k as t,g as a,w as l,l as i,D as I,m as f,y as g,B as c,i as n,j as X,F as $,x as j,h as C}from"./index-CEIzmG_u.js";const q={class:"card-header"},G={key:0},K={key:1,class:"mobile-balance-container"},Z={class:"main-balance-card"},ee={class:"value"},ae={class:"balance-grid"},te={class:"grid-item"},se={class:"grid-value"},le={class:"grid-item"},oe={class:"grid-value"},ne={class:"grid-item"},re={class:"grid-value"},ie={class:"grid-item"},ce={class:"grid-value"},de={key:1,class:"empty-state"},ue={class:"action-btn"},_e={class:"history-container"},ve={class:"history-header"},pe={__name:"MyLeave",setup(me){const h=H(),m=new Date().getFullYear(),o=v(null),D=v([]),E=v([]),y=v(m),A=v(window.innerWidth),b=w(()=>A.value<768);w(()=>b.value?1:2);const T=w(()=>o.value&&o.value.totalBalance||0),M=s=>({ANNUAL:"年假",ADJUSTMENT_ADD:"额度增加",ADJUSTMENT_DEDUCT:"额度扣除",CARRY_OVER:"上年结转",EXPIRED:"过期清理"})[s]||s,V=s=>({ANNUAL:"",ADJUSTMENT_ADD:"warning",ADJUSTMENT_DEDUCT:"danger",CARRY_OVER:"success",EXPIRED:"info"})[s]||"",k=async()=>{const s=h.userId;if(!s){I.warning("未找到用户信息，请重新登录");return}try{const e=await f.get("/leave/account",{params:{userId:s,year:m}});o.value=e}catch(e){console.error(e)}},U=async()=>{const s=h.userId;if(s)try{const e={userId:s};y.value&&(e.year=y.value);const r=await f.get("/leave/history",{params:e});D.value=r}catch(e){console.error(e)}},x=async()=>{try{const s=await f.get("/leave/available-years");E.value=s}catch(s){console.error(s)}},B=async()=>{const s=h.userId;if(s)try{await f.post(`/leave/init?userId=${s}&year=${m}`),I.success("账户初始化成功"),k()}catch(e){console.error(e)}},N=()=>{A.value=window.innerWidth};return O(()=>{k(),U(),x(),window.addEventListener("resize",N)}),P(()=>{window.removeEventListener("resize",N)}),(s,e)=>{const r=i("el-descriptions-item"),R=i("el-tag"),S=i("el-descriptions"),L=i("el-empty"),z=i("el-button"),J=i("el-card"),Y=i("el-option"),Q=i("el-select"),_=i("el-table-column"),F=i("el-table");return d(),p("div",null,[t(J,{class:"box-card"},{header:l(()=>[a("div",q,[a("span",null,"我的假期余额 ("+n(X(m))+")",1)])]),default:l(()=>[o.value?(d(),p("div",G,[b.value?(d(),p("div",K,[a("div",Z,[e[1]||(e[1]=a("div",{class:"label"},"可休合计 (天)",-1)),a("div",ee,n(T.value),1),e[2]||(e[2]=a("div",{class:"sub-label"},"账户状态: 正常活跃",-1))]),a("div",ae,[a("div",te,[e[3]||(e[3]=a("span",{class:"grid-label"},"每年额度",-1)),a("span",se,n(o.value.standardQuota),1)]),a("div",le,[e[4]||(e[4]=a("span",{class:"grid-label"},"当年实际",-1)),a("span",oe,n(o.value.actualQuota),1)]),a("div",ne,[e[5]||(e[5]=a("span",{class:"grid-label"},"上年结转",-1)),a("span",re,n(o.value.lastYearBalance),1)]),a("div",ie,[e[6]||(e[6]=a("span",{class:"grid-label"},"本年已用",-1)),a("span",ce,n(o.value.currentYearUsed),1)])])])):(d(),g(S,{key:0,column:2,border:""},{default:l(()=>[t(r,{label:"工龄"},{default:l(()=>[c(n(o.value.socialSeniority)+" 年",1)]),_:1}),t(r,{label:"入职日期"},{default:l(()=>[c(n(o.value.entryDate),1)]),_:1}),t(r,{label:"每年年假额度"},{default:l(()=>[c(n(o.value.standardQuota)+" 天",1)]),_:1}),t(r,{label:"上年结余"},{default:l(()=>[c(n(o.value.lastYearBalance)+" 天",1)]),_:1}),t(r,{label:"当年在职天数"},{default:l(()=>[c(n(o.value.daysEmployed)+" 天",1)]),_:1}),t(r,{label:"当年年假天数"},{default:l(()=>[c(n(o.value.actualQuota)+" 天",1)]),_:1}),t(r,{label:"本年已用"},{default:l(()=>[c(n(o.value.currentYearUsed)+" 天",1)]),_:1}),t(r,{label:"总可用余额"},{default:l(()=>[t(R,{type:"success",size:"large"},{default:l(()=>[c(n(T.value)+" 天",1)]),_:1})]),_:1})]),_:1}))])):(d(),p("div",de,[t(L,{description:"本年度暂无账户信息"}),a("div",ue,[t(z,{type:"primary",onClick:B,round:""},{default:l(()=>[...e[7]||(e[7]=[c("初始化 2026 账户",-1)])]),_:1})])]))]),_:1}),a("div",_e,[a("div",ve,[e[8]||(e[8]=a("span",{class:"title"},"休假历史",-1)),t(Q,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=u=>y.value=u),placeholder:"选择年份",onChange:U,style:{width:"120px"},clearable:""},{default:l(()=>[t(Y,{label:"全部年份",value:null}),(d(!0),p($,null,j(E.value,u=>(d(),g(Y,{key:u,label:u+" 年",value:u},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),t(F,{data:D.value,style:{width:"100%"},class:"custom-table"},{default:l(()=>[t(_,{prop:"startDate",label:"休假日期","min-width":"110"}),b.value?C("",!0):(d(),g(_,{key:0,prop:"endDate",label:"结束日期","min-width":"110"})),t(_,{prop:"days",label:"天数",width:"70"}),t(_,{prop:"type",label:"类型",width:"90"},{default:l(u=>[t(R,{type:V(u.row.type),size:"small",effect:"light"},{default:l(()=>[c(n(M(u.row.type)),1)]),_:2},1032,["type"])]),_:1}),b.value?C("",!0):(d(),g(_,{key:1,prop:"remarks",label:"备注","min-width":"150","show-overflow-tooltip":""}))]),_:1},8,["data"])])])}}},be=W(pe,[["__scopeId","data-v-a47c074b"]]);export{be as default};
