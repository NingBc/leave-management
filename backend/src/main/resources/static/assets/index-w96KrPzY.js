import{m as j,_ as L,r as p,c as G,H as O,l as i,e as I,f as E,k as e,g as N,w as a,y as A,h as M,F as J,B as x,i as F,o as W,D as w,E as q}from"./index-ClRhICUb.js";function K(){return j.get("/job/list")}function P(v){return j.post("/job/add",v)}function Q(v){return j.post("/job/update",v)}function X(v){return j.post(`/job/delete/${v}`)}function Y(v){return j.post(`/job/run/${v}`)}function Z(v,U){return j.post("/job/changeStatus",null,{params:{id:v,status:U}})}const ee={class:"cron-generator"},le={class:"cron-result"},ae={style:{"margin-left":"10px",color:"#999","font-size":"12px"}},te={__name:"CronGenerator",props:{modelValue:{type:String,default:"0 0 10 * * ?"}},emits:["update:modelValue"],setup(v,{emit:U}){const k=v,H=U,n=p("daily"),b=p("10:00"),u=p("MON"),c=p("10:00"),h=p(1),$=p("10:00"),T=p(""),z=()=>{if(n.value==="daily"){const[s,o]=b.value.split(":");return`0 ${o} ${s} * * ?`}else if(n.value==="weekly"){const[s,o]=c.value.split(":");return`0 ${o} ${s} ? * ${u.value}`}else if(n.value==="monthly"){const[s,o]=$.value.split(":");return`0 ${o} ${s} ${h.value} * ?`}return""},B=s=>{if(!s){n.value="daily",b.value="10:00",u.value="MON",c.value="10:00",h.value=1,$.value="10:00",T.value="";return}const o=s.split(" ");if(o.length<6){n.value="custom",T.value=s;return}const[d,g,f,_,t,y]=o,D=`${f.padStart(2,"0")}:${g.padStart(2,"0")}`;_==="*"&&t==="*"&&y==="?"?(n.value="daily",b.value=D):_==="?"&&t==="*"&&y!=="*"&&y!=="?"?(n.value="weekly",u.value=y,c.value=D):_!=="*"&&_!=="?"&&t==="*"&&y==="?"?(n.value="monthly",h.value=parseInt(_),$.value=D):(n.value="custom",T.value=s)},S=G(()=>n.value==="custom"?T.value:z()),r=G(()=>n.value==="daily"?`每天 ${b.value} 执行`:n.value==="weekly"?`每${{MON:"周一",TUE:"周二",WED:"周三",THU:"周四",FRI:"周五",SAT:"周六",SUN:"周日"}[u.value]||u.value} ${c.value} 执行`:n.value==="monthly"?`每月${h.value}号 ${$.value} 执行`:"自定义 Cron 表达式");O(S,s=>{s!==k.modelValue&&H("update:modelValue",s)}),O(()=>k.modelValue,s=>{s!==S.value&&B(s)},{immediate:!0});const l=()=>{},C=()=>{},V=()=>{};return(s,o)=>{const d=i("el-option"),g=i("el-select"),f=i("el-form-item"),_=i("el-time-picker"),t=i("el-input-number"),y=i("el-input"),D=i("el-form"),R=i("el-tag");return E(),I("div",ee,[e(D,{inline:!0,size:"small"},{default:a(()=>[e(f,{label:"执行周期"},{default:a(()=>[e(g,{modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=m=>n.value=m),onChange:C,style:{width:"120px"}},{default:a(()=>[e(d,{label:"每天",value:"daily"}),e(d,{label:"每周",value:"weekly"}),e(d,{label:"每月",value:"monthly"}),e(d,{label:"自定义",value:"custom"})]),_:1},8,["modelValue"])]),_:1}),n.value==="daily"?(E(),A(f,{key:0,label:"执行时间"},{default:a(()=>[e(_,{modelValue:b.value,"onUpdate:modelValue":o[1]||(o[1]=m=>b.value=m),format:"HH:mm","value-format":"HH:mm",placeholder:"选择时间",onChange:l},null,8,["modelValue"])]),_:1})):M("",!0),n.value==="weekly"?(E(),I(J,{key:1},[e(f,{label:"星期"},{default:a(()=>[e(g,{modelValue:u.value,"onUpdate:modelValue":o[2]||(o[2]=m=>u.value=m),onChange:l,style:{width:"100px"}},{default:a(()=>[e(d,{label:"周一",value:"MON"}),e(d,{label:"周二",value:"TUE"}),e(d,{label:"周三",value:"WED"}),e(d,{label:"周四",value:"THU"}),e(d,{label:"周五",value:"FRI"}),e(d,{label:"周六",value:"SAT"}),e(d,{label:"周日",value:"SUN"})]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"执行时间"},{default:a(()=>[e(_,{modelValue:c.value,"onUpdate:modelValue":o[3]||(o[3]=m=>c.value=m),format:"HH:mm","value-format":"HH:mm",placeholder:"选择时间",onChange:l},null,8,["modelValue"])]),_:1})],64)):M("",!0),n.value==="monthly"?(E(),I(J,{key:2},[e(f,{label:"日期"},{default:a(()=>[e(t,{modelValue:h.value,"onUpdate:modelValue":o[4]||(o[4]=m=>h.value=m),min:1,max:31,onChange:l,style:{width:"80px"}},null,8,["modelValue"])]),_:1}),e(f,{label:"执行时间"},{default:a(()=>[e(_,{modelValue:$.value,"onUpdate:modelValue":o[5]||(o[5]=m=>$.value=m),format:"HH:mm","value-format":"HH:mm",placeholder:"选择时间",onChange:l},null,8,["modelValue"])]),_:1})],64)):M("",!0),n.value==="custom"?(E(),A(f,{key:3,label:"Cron表达式"},{default:a(()=>[e(y,{modelValue:T.value,"onUpdate:modelValue":o[6]||(o[6]=m=>T.value=m),onInput:V,style:{width:"200px"},placeholder:"0 0 10 ? * MON"},null,8,["modelValue"])]),_:1})):M("",!0)]),_:1}),N("div",le,[e(R,null,{default:a(()=>[x(F(S.value),1)]),_:1}),N("span",ae,F(r.value),1)])])}}},oe=L(te,[["__scopeId","data-v-aa784843"]]),ne={class:"toolbar"},ue={class:"dialog-footer"},se={__name:"index",setup(v){const U=p([]),k=p(!1),H=p("添加任务"),n=p("add"),b=p({}),u=p({id:null,jobName:"",jobGroup:"DEFAULT",invokeTarget:"",cronExpression:"",remark:""}),c=async()=>{try{const r=await K();U.value=r}catch(r){console.error(r),w.error("加载任务列表失败")}},h=()=>{n.value="add",H.value="添加任务",u.value={id:null,jobName:"",jobGroup:"DEFAULT",invokeTarget:"",cronExpression:"",remark:""},k.value=!0},$=r=>{n.value="edit",H.value="编辑任务",u.value={...r},k.value=!0},T=async()=>{try{n.value==="add"?(await P(u.value),w.success("任务创建成功")):(await Q(u.value),w.success("任务更新成功")),k.value=!1,c()}catch(r){console.error(r),w.error("操作失败")}},z=async r=>{try{await q.confirm("确定要删除该任务吗？","提示",{type:"warning"}),await X(r.id),w.success("任务删除成功"),c()}catch(l){l!=="cancel"&&(console.error(l),w.error("删除失败"))}},B=async r=>{try{b.value[r]=!0,await Y(r),w.success("任务执行成功")}catch(l){console.error(l),w.error("任务执行失败")}finally{b.value[r]=!1}},S=async r=>{try{const l=r.status===0?1:0;await Z(r.id,l),w.success(l===0?"任务已恢复":"任务已暂停"),c()}catch(l){console.error(l),w.error("状态切换失败")}};return W(()=>{c()}),(r,l)=>{const C=i("el-button"),V=i("el-table-column"),s=i("el-tag"),o=i("el-table"),d=i("el-input"),g=i("el-form-item"),f=i("el-form"),_=i("el-dialog");return E(),I("div",null,[N("div",ne,[l[8]||(l[8]=N("span",null,null,-1)),e(C,{type:"primary",onClick:h},{default:a(()=>[...l[7]||(l[7]=[x("添加任务",-1)])]),_:1})]),e(o,{data:U.value,style:{width:"100%"}},{default:a(()=>[e(V,{prop:"id",label:"任务ID",width:"80"}),e(V,{prop:"jobName",label:"任务名称","min-width":"150"}),e(V,{prop:"jobGroup",label:"任务组",width:"120"}),e(V,{prop:"invokeTarget",label:"调用目标","min-width":"200"}),e(V,{prop:"cronExpression",label:"Cron表达式",width:"150"}),e(V,{label:"状态",width:"100"},{default:a(t=>[e(s,{type:t.row.status===0?"success":"info"},{default:a(()=>[x(F(t.row.status===0?"运行中":"已暂停"),1)]),_:2},1032,["type"])]),_:1}),e(V,{prop:"remark",label:"备注","min-width":"150"}),e(V,{label:"操作",width:"300",fixed:"right"},{default:a(t=>[e(C,{size:"small",onClick:y=>$(t.row)},{default:a(()=>[...l[9]||(l[9]=[x("编辑",-1)])]),_:1},8,["onClick"]),e(C,{size:"small",type:"success",loading:!!b.value[t.row.id],onClick:y=>B(t.row.id)},{default:a(()=>[...l[10]||(l[10]=[x("执行一次",-1)])]),_:1},8,["loading","onClick"]),e(C,{size:"small",type:t.row.status===0?"warning":"primary",onClick:y=>S(t.row)},{default:a(()=>[x(F(t.row.status===0?"暂停":"恢复"),1)]),_:2},1032,["type","onClick"]),e(C,{size:"small",type:"danger",onClick:y=>z(t.row)},{default:a(()=>[...l[11]||(l[11]=[x("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),e(_,{modelValue:k.value,"onUpdate:modelValue":l[6]||(l[6]=t=>k.value=t),title:H.value,width:"600px"},{footer:a(()=>[N("span",ue,[e(C,{onClick:l[5]||(l[5]=t=>k.value=!1)},{default:a(()=>[...l[13]||(l[13]=[x("取消",-1)])]),_:1}),e(C,{type:"primary",onClick:T},{default:a(()=>[...l[14]||(l[14]=[x("确认",-1)])]),_:1})])]),default:a(()=>[e(f,{model:u.value,"label-width":"120px"},{default:a(()=>[e(g,{label:"任务名称"},{default:a(()=>[e(d,{modelValue:u.value.jobName,"onUpdate:modelValue":l[0]||(l[0]=t=>u.value.jobName=t),placeholder:"请输入任务名称"},null,8,["modelValue"])]),_:1}),e(g,{label:"任务组"},{default:a(()=>[e(d,{modelValue:u.value.jobGroup,"onUpdate:modelValue":l[1]||(l[1]=t=>u.value.jobGroup=t),placeholder:"默认为 DEFAULT"},null,8,["modelValue"])]),_:1}),e(g,{label:"调用目标"},{default:a(()=>[e(d,{modelValue:u.value.invokeTarget,"onUpdate:modelValue":l[2]||(l[2]=t=>u.value.invokeTarget=t),placeholder:"例如: dingTalkService.syncLeaveData()"},null,8,["modelValue"]),l[12]||(l[12]=N("span",{style:{color:"#999","font-size":"12px"}},"格式：Bean名称.方法名(参数)",-1))]),_:1}),e(g,{label:"执行计划"},{default:a(()=>[e(oe,{modelValue:u.value.cronExpression,"onUpdate:modelValue":l[3]||(l[3]=t=>u.value.cronExpression=t)},null,8,["modelValue"])]),_:1}),e(g,{label:"备注"},{default:a(()=>[e(d,{modelValue:u.value.remark,"onUpdate:modelValue":l[4]||(l[4]=t=>u.value.remark=t),type:"textarea",rows:3,placeholder:"任务说明"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},de=L(se,[["__scopeId","data-v-12ccd103"]]);export{de as default};
