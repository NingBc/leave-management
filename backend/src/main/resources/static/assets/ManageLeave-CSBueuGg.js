import{m as N,_ as W,r as y,o as Z,e as B,f as i,g as v,k as l,i as Y,w as t,l as s,D as C,F as ee,x as le,y as p,B as u}from"./index-ClnmXTUe.js";function ae(_,T=1,U=10){return N.get("/leave/list",{params:{year:_,current:T,size:U}})}function te(_){return N.post("/leave/updateAccount",_)}function oe(_){return N.post("/leave/add-record",_)}const ne={class:"toolbar",style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"15px"}},de={style:{display:"flex","align-items":"center"}},re={class:"dialog-footer"},se={__name:"ManageLeave",setup(_){const T=new Date().getFullYear(),U=y([]),b=y(!1),o=y({userId:null,year:T,realName:"",socialSeniority:0,standardQuota:0,daysEmployed:0,actualQuota:0,lastYearBalance:0,currentYearUsed:0,totalBalance:0,records:[]}),A=y(new Date().getFullYear()),g=y([]),w=y(1),E=y(10),z=y(0),h=async()=>{try{const n=await N.get("/leave/available-years");g.value=n||[];const e=new Date().getFullYear();g.value.includes(e)||g.value.unshift(e)}catch(n){console.error("Failed to load available years",n);const e=new Date().getFullYear();g.value=[e,e-1,e-2]}},V=async()=>{try{const n=await ae(A.value,w.value,E.value);U.value=n.records||[],z.value=n.total||0}catch(n){console.error(n),C.error("数据加载失败")}},J=n=>{E.value=n,w.value=1,V()},L=n=>{w.value=n,V()},Q=n=>({ANNUAL:"年假",ADJUSTMENT_ADD:"额度增加",ADJUSTMENT_DEDUCT:"额度扣除",CARRY_OVER:"年假结转",EXPIRED:"过期清理"})[n]||n,F=n=>({ANNUAL:"primary",ADJUSTMENT_ADD:"warning",ADJUSTMENT_DEDUCT:"danger",EXPIRED:"info",CARRY_OVER:"success"})[n]||"info",I=n=>{o.value={...n,records:n.records||[]},b.value=!0},P=()=>({id:null,startDate:"",endDate:"",days:1,type:"ANNUAL",remarks:""}),O=()=>{o.value.records||(o.value.records=[]),o.value.records.push(P())},j=async()=>{try{if(await te(o.value),o.value.records&&o.value.records.length>0){const n=o.value.records.filter(e=>!e.id);for(const e of n)e.userId=o.value.userId,await oe(e)}C.success("保存成功"),b.value=!1,V()}catch(n){console.error(n),C.error("保存失败")}};return Z(()=>{h(),V()}),(n,e)=>{const k=s("el-option"),R=s("el-select"),d=s("el-table-column"),m=s("el-tag"),D=s("el-button"),x=s("el-table"),X=s("el-popover"),$=s("el-pagination"),q=s("el-alert"),S=s("el-input"),c=s("el-form-item"),f=s("el-input-number"),G=s("el-divider"),M=s("el-date-picker"),H=s("el-form"),K=s("el-dialog");return i(),B("div",null,[v("h3",null,"年假管理 ("+Y(A.value)+")",1),v("div",ne,[v("div",de,[e[12]||(e[12]=v("span",{style:{"margin-right":"10px"}},"查看年份：",-1)),l(R,{modelValue:A.value,"onUpdate:modelValue":e[0]||(e[0]=a=>A.value=a),onChange:V,style:{width:"120px"}},{default:t(()=>[(i(!0),B(ee,null,le(g.value,a=>(i(),p(k,{key:a,label:a+"年",value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),l(x,{data:U.value,style:{width:"100%"},border:"",stripe:""},{default:t(()=>[l(d,{prop:"employeeNumber",label:"工号",width:"100"}),l(d,{prop:"realName",label:"姓名",width:"120"}),l(d,{prop:"socialSeniority",label:"工龄(年)",width:"120"}),l(d,{prop:"standardQuota",label:"标准额度",width:"100"}),l(d,{prop:"daysEmployed",label:"在职天数",width:"120"}),l(d,{prop:"actualQuota",label:"实际额度",width:"100"}),l(d,{prop:"lastYearBalance",label:"上年结余",width:"100"}),l(d,{prop:"currentYearUsed",label:"今年已用",width:"100"}),l(d,{prop:"totalBalance",label:"年假余额",width:"100"},{default:t(a=>[l(m,{type:"success"},{default:t(()=>[u(Y(a.row.totalBalance),1)]),_:2},1024)]),_:1}),l(d,{label:"使用记录","min-width":"150"},{default:t(a=>[l(X,{placement:"right",width:800,trigger:"click"},{reference:t(()=>[l(D,{type:"primary",link:""},{default:t(()=>[...e[13]||(e[13]=[u("查看详情",-1)])]),_:1})]),default:t(()=>[l(x,{data:a.row.records,border:"",size:"small"},{default:t(()=>[l(d,{prop:"startDate",label:"开始日期",width:"120"}),l(d,{prop:"endDate",label:"结束日期",width:"120"}),l(d,{prop:"days",label:"天数",width:"80"}),l(d,{prop:"remarks",label:"备注","min-width":"150"}),l(d,{prop:"type",label:"类型",width:"120"},{default:t(({row:r})=>[r.type==="ANNUAL"?(i(),p(m,{key:0,type:"success"},{default:t(()=>[...e[14]||(e[14]=[u("年假",-1)])]),_:1})):r.type==="ADJUSTMENT_ADD"?(i(),p(m,{key:1,type:"warning"},{default:t(()=>[...e[15]||(e[15]=[u("额度增加",-1)])]),_:1})):r.type==="ADJUSTMENT_DEDUCT"?(i(),p(m,{key:2,type:"danger"},{default:t(()=>[...e[16]||(e[16]=[u("额度扣除",-1)])]),_:1})):r.type==="CARRY_OVER"?(i(),p(m,{key:3,type:"info"},{default:t(()=>[...e[17]||(e[17]=[u("年假结转",-1)])]),_:1})):r.type==="EXPIRED"?(i(),p(m,{key:4,type:"danger"},{default:t(()=>[...e[18]||(e[18]=[u("过期清理",-1)])]),_:1})):(i(),p(m,{key:5},{default:t(()=>[u(Y(r.type),1)]),_:2},1024))]),_:1})]),_:1},8,["data"])]),_:2},1024)]),_:1}),l(d,{label:"操作",width:"100",fixed:"right"},{default:t(a=>[l(D,{type:"primary",size:"small",onClick:r=>I(a.row)},{default:t(()=>[...e[19]||(e[19]=[u("编辑",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),l($,{"current-page":w.value,"onUpdate:currentPage":e[1]||(e[1]=a=>w.value=a),"page-size":E.value,"onUpdate:pageSize":e[2]||(e[2]=a=>E.value=a),"page-sizes":[10,20,50,100],total:z.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:J,onCurrentChange:L,style:{"margin-top":"20px","justify-content":"flex-end"}},null,8,["current-page","page-size","total"]),l(K,{modelValue:b.value,"onUpdate:modelValue":e[11]||(e[11]=a=>b.value=a),title:"编辑年假账户",width:"900px"},{footer:t(()=>[v("span",re,[l(D,{onClick:e[10]||(e[10]=a=>b.value=!1)},{default:t(()=>[...e[24]||(e[24]=[u("取消",-1)])]),_:1}),l(D,{type:"primary",onClick:j},{default:t(()=>[...e[25]||(e[25]=[u("保存",-1)])]),_:1})])]),default:t(()=>[l(q,{title:"基础数据由系统自动计算",type:"info",description:"工龄、额度等数据根据员工档案自动生成，不可直接修改。如需调整余额（例如奖励或惩罚），请在下方添加'额度增加'或'额度扣除'记录。","show-icon":"",closable:!1,style:{"margin-bottom":"20px"}}),l(H,{model:o.value,"label-width":"140px"},{default:t(()=>[l(c,{label:"员工"},{default:t(()=>[l(S,{modelValue:o.value.realName,"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.realName=a),disabled:""},null,8,["modelValue"])]),_:1}),l(c,{label:"工龄(年)"},{default:t(()=>[l(f,{modelValue:o.value.socialSeniority,"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.socialSeniority=a),disabled:""},null,8,["modelValue"])]),_:1}),l(c,{label:"标准额度"},{default:t(()=>[l(f,{modelValue:o.value.standardQuota,"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.standardQuota=a),precision:1,step:.5,disabled:""},null,8,["modelValue"])]),_:1}),l(c,{label:"在职天数"},{default:t(()=>[l(f,{modelValue:o.value.daysEmployed,"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.daysEmployed=a),disabled:""},null,8,["modelValue"])]),_:1}),l(c,{label:"实际额度"},{default:t(()=>[l(f,{modelValue:o.value.actualQuota,"onUpdate:modelValue":e[7]||(e[7]=a=>o.value.actualQuota=a),precision:1,step:.5,disabled:""},null,8,["modelValue"])]),_:1}),l(c,{label:"上年结余"},{default:t(()=>[l(f,{modelValue:o.value.lastYearBalance,"onUpdate:modelValue":e[8]||(e[8]=a=>o.value.lastYearBalance=a),precision:1,step:.5},null,8,["modelValue"]),e[20]||(e[20]=v("span",{style:{"margin-left":"10px",color:"#999","font-size":"12px"}},"（可手动修正）",-1))]),_:1}),l(c,{label:"今年已用"},{default:t(()=>[l(f,{modelValue:o.value.currentYearUsed,"onUpdate:modelValue":e[9]||(e[9]=a=>o.value.currentYearUsed=a),precision:1,step:.5,disabled:""},null,8,["modelValue"]),e[21]||(e[21]=v("span",{style:{"margin-left":"10px",color:"#999","font-size":"12px"}},"（由休假记录自动计算）",-1))]),_:1}),l(G,null,{default:t(()=>[...e[22]||(e[22]=[u("休假记录管理",-1)])]),_:1}),l(D,{type:"primary",size:"small",onClick:O,style:{"margin-bottom":"10px"}},{default:t(()=>[...e[23]||(e[23]=[u("添加记录",-1)])]),_:1}),l(x,{data:o.value.records,border:"",size:"small",style:{width:"100%"}},{default:t(()=>[l(d,{prop:"startDate",label:"开始日期",width:"140"},{default:t(a=>[l(M,{modelValue:a.row.startDate,"onUpdate:modelValue":r=>a.row.startDate=r,type:"date",placeholder:"选择日期",size:"small","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(d,{prop:"endDate",label:"结束日期",width:"140"},{default:t(a=>[l(M,{modelValue:a.row.endDate,"onUpdate:modelValue":r=>a.row.endDate=r,type:"date",placeholder:"选择日期",size:"small","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(d,{prop:"days",label:"天数",width:"110"},{default:t(a=>[l(f,{modelValue:a.row.days,"onUpdate:modelValue":r=>a.row.days=r,step:.5,precision:1,size:"small",style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(d,{prop:"remarks",label:"备注","min-width":"150"},{default:t(a=>[l(S,{modelValue:a.row.remarks,"onUpdate:modelValue":r=>a.row.remarks=r,placeholder:"请输入备注",size:"small",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(d,{prop:"type",label:"类型",width:"150"},{default:t(a=>[a.row.id===null?(i(),p(R,{key:0,modelValue:a.row.type,"onUpdate:modelValue":r=>a.row.type=r,placeholder:"请选择",size:"small",style:{width:"100%"}},{default:t(()=>[l(k,{label:"年假 (补录)",value:"ANNUAL"}),l(k,{label:"额度增加 (奖励/恢复)",value:"ADJUSTMENT_ADD"}),l(k,{label:"额度扣除 (惩罚/冲销)",value:"ADJUSTMENT_DEDUCT"})]),_:1},8,["modelValue","onUpdate:modelValue"])):(i(),p(m,{key:1,type:F(a.row.type),size:"small"},{default:t(()=>[u(Y(Q(a.row.type)),1)]),_:2},1032,["type"]))]),_:1})]),_:1},8,["data"])]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ie=W(se,[["__scopeId","data-v-e4d96e44"]]);export{ie as default};
