import{m as j,_ as L,r as f,c as G,H as O,l as i,e as M,f as E,k as e,g as N,w as t,y as A,h as D,F as J,B as w,i as F,o as W,D as y,E as q}from"./index-CEIzmG_u.js";function K(){return j.get("/job/list")}function P(v){return j.post("/job/add",v)}function Q(v){return j.post("/job/update",v)}function X(v){return j.post(`/job/delete/${v}`)}function Y(v){return j.post(`/job/run/${v}`)}function Z(v,T){return j.post("/job/changeStatus",null,{params:{id:v,status:T}})}const ee={class:"cron-generator"},le={class:"cron-result"},ae={style:{"margin-left":"10px",color:"#999","font-size":"12px"}},te={__name:"CronGenerator",props:{modelValue:{type:String,default:"0 0 10 * * ?"}},emits:["update:modelValue"],setup(v,{emit:T}){const V=v,H=T,n=f("daily"),u=f("10:00"),c=f("MON"),k=f("10:00"),C=f(1),x=f("10:00"),h=f(""),I=()=>{if(n.value==="daily"){const[s,o]=u.value.split(":");return`0 ${o} ${s} * * ?`}else if(n.value==="weekly"){const[s,o]=k.value.split(":");return`0 ${o} ${s} ? * ${c.value}`}else if(n.value==="monthly"){const[s,o]=x.value.split(":");return`0 ${o} ${s} ${C.value} * ?`}return""},z=s=>{if(!s){n.value="daily",u.value="10:00",c.value="MON",k.value="10:00",C.value=1,x.value="10:00",h.value="";return}const o=s.split(" ");if(o.length<6){n.value="custom",h.value=s;return}const[d,U,_,a,g,$]=o,S=`${_.padStart(2,"0")}:${U.padStart(2,"0")}`;a==="*"&&g==="*"&&$==="?"?(n.value="daily",u.value=S):a==="?"&&g==="*"&&$!=="*"&&$!=="?"?(n.value="weekly",c.value=$,k.value=S):a!=="*"&&a!=="?"&&g==="*"&&$==="?"?(n.value="monthly",C.value=parseInt(a),x.value=S):(n.value="custom",h.value=s)},r=G(()=>n.value==="custom"?h.value:I()),l=G(()=>n.value==="daily"?`每天 ${u.value} 执行`:n.value==="weekly"?`每${{MON:"周一",TUE:"周二",WED:"周三",THU:"周四",FRI:"周五",SAT:"周六",SUN:"周日"}[c.value]||c.value} ${k.value} 执行`:n.value==="monthly"?`每月${C.value}号 ${x.value} 执行`:"自定义 Cron 表达式");O(r,s=>{s!==V.modelValue&&H("update:modelValue",s)}),O(()=>V.modelValue,s=>{s!==r.value&&z(s)},{immediate:!0});const m=()=>{},b=()=>{},B=()=>{};return(s,o)=>{const d=i("el-option"),U=i("el-select"),_=i("el-form-item"),a=i("el-time-picker"),g=i("el-input-number"),$=i("el-input"),S=i("el-form"),R=i("el-tag");return E(),M("div",ee,[e(S,{inline:!0,size:"small"},{default:t(()=>[e(_,{label:"执行周期"},{default:t(()=>[e(U,{modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=p=>n.value=p),onChange:b,style:{width:"120px"}},{default:t(()=>[e(d,{label:"每天",value:"daily"}),e(d,{label:"每周",value:"weekly"}),e(d,{label:"每月",value:"monthly"}),e(d,{label:"自定义",value:"custom"})]),_:1},8,["modelValue"])]),_:1}),n.value==="daily"?(E(),A(_,{key:0,label:"执行时间"},{default:t(()=>[e(a,{modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=p=>u.value=p),format:"HH:mm","value-format":"HH:mm",placeholder:"选择时间",onChange:m},null,8,["modelValue"])]),_:1})):D("",!0),n.value==="weekly"?(E(),M(J,{key:1},[e(_,{label:"星期"},{default:t(()=>[e(U,{modelValue:c.value,"onUpdate:modelValue":o[2]||(o[2]=p=>c.value=p),onChange:m,style:{width:"100px"}},{default:t(()=>[e(d,{label:"周一",value:"MON"}),e(d,{label:"周二",value:"TUE"}),e(d,{label:"周三",value:"WED"}),e(d,{label:"周四",value:"THU"}),e(d,{label:"周五",value:"FRI"}),e(d,{label:"周六",value:"SAT"}),e(d,{label:"周日",value:"SUN"})]),_:1},8,["modelValue"])]),_:1}),e(_,{label:"执行时间"},{default:t(()=>[e(a,{modelValue:k.value,"onUpdate:modelValue":o[3]||(o[3]=p=>k.value=p),format:"HH:mm","value-format":"HH:mm",placeholder:"选择时间",onChange:m},null,8,["modelValue"])]),_:1})],64)):D("",!0),n.value==="monthly"?(E(),M(J,{key:2},[e(_,{label:"日期"},{default:t(()=>[e(g,{modelValue:C.value,"onUpdate:modelValue":o[4]||(o[4]=p=>C.value=p),min:1,max:31,onChange:m,style:{width:"80px"}},null,8,["modelValue"])]),_:1}),e(_,{label:"执行时间"},{default:t(()=>[e(a,{modelValue:x.value,"onUpdate:modelValue":o[5]||(o[5]=p=>x.value=p),format:"HH:mm","value-format":"HH:mm",placeholder:"选择时间",onChange:m},null,8,["modelValue"])]),_:1})],64)):D("",!0),n.value==="custom"?(E(),A(_,{key:3,label:"Cron表达式"},{default:t(()=>[e($,{modelValue:h.value,"onUpdate:modelValue":o[6]||(o[6]=p=>h.value=p),onInput:B,style:{width:"200px"},placeholder:"0 0 10 ? * MON"},null,8,["modelValue"])]),_:1})):D("",!0)]),_:1}),N("div",le,[e(R,null,{default:t(()=>[w(F(r.value),1)]),_:1}),N("span",ae,F(l.value),1)])])}}},oe=L(te,[["__scopeId","data-v-aa784843"]]),ne={class:"toolbar"},ue={class:"dialog-footer"},se={__name:"index",setup(v){const T=f([]),V=f(!1),H=f("添加任务"),n=f("add"),u=f({id:null,jobName:"",jobGroup:"DEFAULT",invokeTarget:"",cronExpression:"",remark:""}),c=async()=>{try{const r=await K();T.value=r}catch(r){console.error(r),y.error("加载任务列表失败")}},k=()=>{n.value="add",H.value="添加任务",u.value={id:null,jobName:"",jobGroup:"DEFAULT",invokeTarget:"",cronExpression:"",remark:""},V.value=!0},C=r=>{n.value="edit",H.value="编辑任务",u.value={...r},V.value=!0},x=async()=>{try{n.value==="add"?(await P(u.value),y.success("任务创建成功")):(await Q(u.value),y.success("任务更新成功")),V.value=!1,c()}catch(r){console.error(r),y.error("操作失败")}},h=async r=>{try{await q.confirm("确定要删除该任务吗？","提示",{type:"warning"}),await X(r.id),y.success("任务删除成功"),c()}catch(l){l!=="cancel"&&(console.error(l),y.error("删除失败"))}},I=async r=>{try{await Y(r),y.success("任务执行成功")}catch(l){console.error(l),y.error("任务执行失败")}},z=async r=>{try{const l=r.status===0?1:0;await Z(r.id,l),y.success(l===0?"任务已恢复":"任务已暂停"),c()}catch(l){console.error(l),y.error("状态切换失败")}};return W(()=>{c()}),(r,l)=>{const m=i("el-button"),b=i("el-table-column"),B=i("el-tag"),s=i("el-table"),o=i("el-input"),d=i("el-form-item"),U=i("el-form"),_=i("el-dialog");return E(),M("div",null,[N("div",ne,[l[8]||(l[8]=N("span",null,null,-1)),e(m,{type:"primary",onClick:k},{default:t(()=>[...l[7]||(l[7]=[w("添加任务",-1)])]),_:1})]),e(s,{data:T.value,style:{width:"100%"}},{default:t(()=>[e(b,{prop:"id",label:"任务ID",width:"80"}),e(b,{prop:"jobName",label:"任务名称","min-width":"150"}),e(b,{prop:"jobGroup",label:"任务组",width:"120"}),e(b,{prop:"invokeTarget",label:"调用目标","min-width":"200"}),e(b,{prop:"cronExpression",label:"Cron表达式",width:"150"}),e(b,{label:"状态",width:"100"},{default:t(a=>[e(B,{type:a.row.status===0?"success":"info"},{default:t(()=>[w(F(a.row.status===0?"运行中":"已暂停"),1)]),_:2},1032,["type"])]),_:1}),e(b,{prop:"remark",label:"备注","min-width":"150"}),e(b,{label:"操作",width:"300",fixed:"right"},{default:t(a=>[e(m,{size:"small",onClick:g=>C(a.row)},{default:t(()=>[...l[9]||(l[9]=[w("编辑",-1)])]),_:1},8,["onClick"]),e(m,{size:"small",type:"success",onClick:g=>I(a.row.id)},{default:t(()=>[...l[10]||(l[10]=[w("执行一次",-1)])]),_:1},8,["onClick"]),e(m,{size:"small",type:a.row.status===0?"warning":"primary",onClick:g=>z(a.row)},{default:t(()=>[w(F(a.row.status===0?"暂停":"恢复"),1)]),_:2},1032,["type","onClick"]),e(m,{size:"small",type:"danger",onClick:g=>h(a.row)},{default:t(()=>[...l[11]||(l[11]=[w("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),e(_,{modelValue:V.value,"onUpdate:modelValue":l[6]||(l[6]=a=>V.value=a),title:H.value,width:"600px"},{footer:t(()=>[N("span",ue,[e(m,{onClick:l[5]||(l[5]=a=>V.value=!1)},{default:t(()=>[...l[13]||(l[13]=[w("取消",-1)])]),_:1}),e(m,{type:"primary",onClick:x},{default:t(()=>[...l[14]||(l[14]=[w("确认",-1)])]),_:1})])]),default:t(()=>[e(U,{model:u.value,"label-width":"120px"},{default:t(()=>[e(d,{label:"任务名称"},{default:t(()=>[e(o,{modelValue:u.value.jobName,"onUpdate:modelValue":l[0]||(l[0]=a=>u.value.jobName=a),placeholder:"请输入任务名称"},null,8,["modelValue"])]),_:1}),e(d,{label:"任务组"},{default:t(()=>[e(o,{modelValue:u.value.jobGroup,"onUpdate:modelValue":l[1]||(l[1]=a=>u.value.jobGroup=a),placeholder:"默认为 DEFAULT"},null,8,["modelValue"])]),_:1}),e(d,{label:"调用目标"},{default:t(()=>[e(o,{modelValue:u.value.invokeTarget,"onUpdate:modelValue":l[2]||(l[2]=a=>u.value.invokeTarget=a),placeholder:"例如: dingTalkService.syncLeaveData()"},null,8,["modelValue"]),l[12]||(l[12]=N("span",{style:{color:"#999","font-size":"12px"}},"格式：Bean名称.方法名(参数)",-1))]),_:1}),e(d,{label:"执行计划"},{default:t(()=>[e(oe,{modelValue:u.value.cronExpression,"onUpdate:modelValue":l[3]||(l[3]=a=>u.value.cronExpression=a)},null,8,["modelValue"])]),_:1}),e(d,{label:"备注"},{default:t(()=>[e(o,{modelValue:u.value.remark,"onUpdate:modelValue":l[4]||(l[4]=a=>u.value.remark=a),type:"textarea",rows:3,placeholder:"任务说明"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},de=L(se,[["__scopeId","data-v-eeae4ab4"]]);export{de as default};
